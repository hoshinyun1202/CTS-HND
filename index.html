<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hokkaido Winter Journal - Pro</title>
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/4.1.0/vuedraggable.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #D0E1E9;
            background-image: radial-gradient(#B8D0DB 1px, transparent 1px);
            background-size: 20px 20px;
            color: #4A5568;
            overflow-x: hidden;
        }

        .soft-shadow { box-shadow: 6px 6px 0px #CBD5E0; }
        
        .banner-container {
            width: 100%;
            height: 380px;
            overflow: hidden;
            position: relative;
        }
        .banner-img {
            width: 100%; height: 100%; object-fit: cover; object-position: center 80%;
        }

        .main-content {
            margin-top: -40px;
            border-radius: 40px 40px 0 0;
            position: relative;
            z-index: 20;
            background: #F7F9FB;
            min-height: 100vh;
        }

        /* 隱藏捲動條 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* 彈窗動畫 */
        .modal-enter-active, .modal-leave-active { transition: opacity 0.3s ease; }
        .modal-enter-from, .modal-leave-to { opacity: 0; }

        /* 拖拽時的樣式 */
        .ghost { opacity: 0.5; background: #E2E8F0; border: 2px dashed #4A5568; }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen pb-32">
    
    <!-- 1. Header Banner -->
    <header class="banner-container">
        <img src="banner.jpg" class="banner-img" onerror="this.src='https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=1200'">
        
        <!-- Tab Navigation -->
        <div class="absolute bottom-14 right-4 flex gap-2 z-30">
            <button @click="currentTab = 'itinerary'" class="w-10 h-10 rounded-full bg-white/90 backdrop-blur shadow-lg flex items-center justify-center active:scale-95 transition-all">
                <i data-lucide="map-pin" class="w-5 h-5 text-blue-500"></i>
            </button>
            <button @click="currentTab = 'info'" class="w-10 h-10 rounded-full bg-white/90 backdrop-blur shadow-lg flex items-center justify-center active:scale-95 transition-all">
                <i data-lucide="info" class="w-5 h-5 text-green-600"></i>
            </button>
            <button @click="currentTab = 'shopping'" class="w-10 h-10 rounded-full bg-white/90 backdrop-blur shadow-lg flex items-center justify-center active:scale-95 transition-all">
                <i data-lucide="shopping-basket" class="w-5 h-5 text-orange-400"></i>
            </button>
            <button @click="currentTab = 'expense'" class="w-10 h-10 rounded-full bg-white/90 backdrop-blur shadow-lg flex items-center justify-center active:scale-95 transition-all">
                <i data-lucide="circle-dollar-sign" class="w-5 h-5 text-red-400"></i>
            </button>
        </div>
    </header>

    <!-- 2. Main Content -->
    <main class="main-content px-5 pt-8">
        
        <div v-if="currentTab === 'itinerary'">
            <!-- 天氣與標題 -->
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-slate-700">北海道冬日行</h1>
                    <p class="text-xs text-slate-400">11/06 - 11/16 Journey</p>
                </div>
                <div class="text-right bg-blue-50 p-2 rounded-2xl border border-blue-100">
                    <div class="flex items-center gap-1 text-blue-600 font-bold">
                        <i data-lucide="sun-cloud" class="w-4 h-4"></i> 2°C
                    </div>
                    <p class="text-[9px] text-blue-400">體感 -1°C</p>
                </div>
            </div>

            <!-- 橫向日期選擇 -->
            <div class="flex overflow-x-auto no-scrollbar gap-3 mb-8 pb-2">
                <div v-for="d in dates" :key="d.date" 
                     @click="selectedDate = d.date"
                     :class="selectedDate === d.date ? 'bg-slate-700 text-white shadow-lg' : 'bg-white text-slate-400'"
                     class="flex-shrink-0 w-12 h-16 rounded-2xl flex flex-col items-center justify-center soft-shadow cursor-pointer border border-slate-100">
                    <span class="text-[10px] uppercase font-bold">{{ d.weekday }}</span>
                    <span class="text-lg font-bold">{{ d.day }}</span>
                </div>
            </div>

            <!-- 行程列表 (Draggable) -->
            <div class="ml-2">
                <draggable 
                    v-model="schedule" 
                    item-key="id"
                    handle=".drag-handle"
                    ghost-class="ghost"
                    @end="saveToLocal"
                >
                    <template #item="{element, index}">
                        <div v-if="element.date === selectedDate">
                            <!-- 行程卡片 -->
                            <div class="relative pl-8 mb-4">
                                <!-- 時間軸線 -->
                                <div class="absolute left-3 top-0 bottom-0 w-0.5 border-l-2 border-dashed border-slate-200"></div>
                                <div class="absolute left-0 top-1 w-6 h-6 bg-white border-2 border-slate-700 rounded-full flex items-center justify-center z-10 drag-handle cursor-grab">
                                    <i :data-lucide="getCategoryIcon(element.category)" class="w-3 h-3 text-slate-700"></i>
                                </div>

                                <div class="bg-white rounded-2xl p-4 soft-shadow border border-slate-50 relative group" @click="editItem(element)">
                                    <div class="flex justify-between items-start mb-1">
                                        <span class="text-[10px] font-bold text-slate-400">{{ element.time }}</span>
                                        <span class="px-2 py-0.5 rounded-full text-[9px] font-bold" :class="getCategoryStyle(element.category)">
                                            {{ element.category }}
                                        </span>
                                    </div>
                                    <h3 class="font-bold text-slate-700">{{ element.title }}</h3>
                                    
                                    <div class="mt-2 space-y-1">
                                        <p v-if="element.openTime" class="text-[10px] text-slate-400 flex items-center gap-1">
                                            <i data-lucide="clock" class="w-3 h-3"></i> {{ element.openTime }}
                                        </p>
                                        <p v-if="element.ticket" class="text-[10px] text-blue-500 flex items-center gap-1">
                                            <i data-lucide="ticket" class="w-3 h-3"></i> {{ element.ticket }}
                                        </p>
                                        <p v-if="element.note" class="text-xs text-slate-500 mt-1 italic">「{{ element.note }}」</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 交通時間顯示 (如果不是最後一個行程) -->
                            <div v-if="getNextItem(index)" class="pl-8 my-2 flex items-center gap-2">
                                <div class="bg-slate-100 px-3 py-1 rounded-full flex items-center gap-2 text-[10px] text-slate-400 border border-slate-200">
                                    <i :data-lucide="element.transMode || 'car'" class="w-3 h-3"></i>
                                    <span>{{ element.transTime || '--' }} mins</span>
                                </div>
                            </div>
                        </div>
                    </template>
                </draggable>
            </div>

            <!-- 右下角新增按鈕 -->
            <button @click="openAddModal" class="fixed bottom-28 right-6 w-14 h-14 bg-slate-700 text-white rounded-full shadow-2xl flex items-center justify-center active:scale-90 transition-all z-50">
                <i data-lucide="plus" class="w-8 h-8"></i>
            </button>
        </div>

        <!-- 3. 其他分頁 (Info/Shopping/Expense 保持簡化) -->
        <div v-else class="text-center py-20 text-slate-400">
            <p>{{ currentTab.toUpperCase() }} Content Coming Soon...</p>
        </div>

    </main>

    <!-- 4. 新增/編輯行程彈窗 -->
    <transition name="modal">
        <div v-if="showModal" class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" @click="showModal = false"></div>
            <div class="relative bg-white w-full max-w-md rounded-t-[40px] sm:rounded-[40px] p-8 shadow-2xl overflow-y-auto max-h-[90vh]">
                <div class="w-12 h-1.5 bg-slate-200 rounded-full mx-auto mb-6 sm:hidden"></div>
                <h2 class="text-xl font-bold mb-6 text-slate-700">{{ isEditing ? '編輯行程' : '新增行程' }}</h2>
                
                <div class="space-y-4">
                    <!-- 分類選擇 -->
                    <div>
                        <label class="text-xs font-bold text-slate-400 block mb-1">行程分類</label>
                        <select v-model="form.category" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm focus:ring-2 focus:ring-slate-200">
                            <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                        </select>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-slate-400 block mb-1">行程名稱</label>
                        <input v-model="form.title" type="text" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm" placeholder="例如：新千歲機場">
                    </div>

                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label class="text-xs font-bold text-slate-400 block mb-1">出發時間</label>
                            <input v-model="form.time" type="time" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm">
                        </div>
                        <div class="flex-1">
                            <label class="text-xs font-bold text-slate-400 block mb-1">預計交通 (分)</label>
                            <input v-model="form.transTime" type="number" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm">
                        </div>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-slate-400 block mb-1">交通工具</label>
                        <div class="flex gap-2">
                            <button v-for="m in ['foot', 'car', 'bus']" @click="form.transMode = m" 
                                :class="form.transMode === m ? 'bg-slate-700 text-white' : 'bg-slate-100 text-slate-400'"
                                class="flex-1 py-2 rounded-xl text-xs flex items-center justify-center gap-1 transition-all">
                                <i :data-lucide="m" class="w-3 h-3"></i> {{ m === 'foot' ? '步行' : m === 'car' ? '開車' : '公車' }}
                            </button>
                        </div>
                    </div>

                    <!-- 動態欄位 -->
                    <div v-if="['景點','住宿','美食','購物'].includes(form.category)">
                        <label class="text-xs font-bold text-slate-400 block mb-1">營業/Check-in 時間</label>
                        <input v-model="form.openTime" type="text" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm" placeholder="例如：09:00-17:00">
                    </div>

                    <div v-if="form.category === '景點'">
                        <label class="text-xs font-bold text-slate-400 block mb-1">門票資訊</label>
                        <input v-model="form.ticket" type="text" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm" placeholder="例如：成人 1500円">
                    </div>

                    <div>
                        <label class="text-xs font-bold text-slate-400 block mb-1">特色 & 備註</label>
                        <textarea v-model="form.note" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm h-20" placeholder="想紀錄的事情..."></textarea>
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button v-if="isEditing" @click="confirmDelete" class="flex-1 py-3 rounded-2xl bg-red-50 text-red-500 font-bold text-sm active:scale-95 transition-all">刪除行程</button>
                        <button @click="saveForm" class="flex-[2] py-3 rounded-2xl bg-slate-700 text-white font-bold text-sm active:scale-95 transition-all">儲存行程</button>
                    </div>
                </div>
            </div>
        </div>
    </transition>

    <!-- 底部導航 -->
    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-md bg-white/90 backdrop-blur-md h-18 rounded-3xl border border-slate-100 shadow-2xl flex items-center justify-around px-6 z-50">
        <button v-for="tab in ['itinerary','info','shopping','expense']" @click="currentTab = tab" 
            :class="currentTab === tab ? 'text-slate-800' : 'text-slate-300'" class="flex flex-col items-center gap-1 transition-all">
            <i :data-lucide="tab === 'itinerary' ? 'calendar' : tab === 'info' ? 'info' : tab === 'shopping' ? 'shopping-bag' : 'wallet'" class="w-6 h-6"></i>
            <span class="text-[9px] font-bold">{{ tab === 'itinerary' ? '行程' : tab === 'info' ? '資訊' : tab === 'shopping' ? '購物' : '花費' }}</span>
        </button>
    </nav>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

    const app = createApp({
        components: {
            draggable: window.vuedraggable
        },
        setup() {
            const currentTab = ref('itinerary');
            const selectedDate = ref('2025-11-06');
            const showModal = ref(false);
            const isEditing = ref(false);
            const categories = ['景點', '住宿', '美食', '購物', '航班', '其他'];
            
            // 行程數據
            const schedule = ref(JSON.parse(localStorage.getItem('my_hokkaido_itinerary')) || [
                { id: 1, date: '2025-11-06', time: '09:10', category: '航班', title: 'TSA-HND-CTS 轉機出發', note: 'JL96 (09:10-13:00)', transMode: 'bus', transTime: 120 },
                { id: 2, date: '2025-11-06', time: '17:30', category: '交通', title: '新千歲機場 JR 車站', transMode: 'car', transTime: 30 },
                { id: 3, date: '2025-11-06', time: '18:00', category: '住宿', title: 'Mitsui Garden Hotel', openTime: '15:00 Check-in' }
            ]);

            const form = ref({ id: null, date: '', category: '景點', title: '', time: '', openTime: '', ticket: '', note: '', transMode: 'car', transTime: '' });

            const dates = [
                { weekday: 'Thu', day: '06', date: '2025-11-06' },
                { weekday: 'Fri', day: '07', date: '2025-11-07' },
                { weekday: 'Sat', day: '08', date: '2025-11-08' },
                { weekday: 'Sun', day: '09', date: '2025-11-09' },
                { weekday: 'Mon', day: '10', date: '2025-11-10' },
                { weekday: 'Tue', day: '11', date: '2025-11-11' },
                { weekday: 'Wed', day: '12', date: '2025-11-12' },
                { weekday: 'Thu', day: '13', date: '2025-11-13' },
                { weekday: 'Fri', day: '14', date: '2025-11-14' },
                { weekday: 'Sat', day: '15', date: '2025-11-15' },
                { weekday: 'Sun', day: '16', date: '2025-11-16' },
            ];

            const getNextItem = (index) => {
                const current = schedule.value[index];
                return schedule.value.slice(index + 1).find(item => item.date === current.date);
            };

            const openAddModal = () => {
                isEditing.value = false;
                form.value = { id: Date.now(), date: selectedDate.value, category: '景點', title: '', time: '09:00', openTime: '', ticket: '', note: '', transMode: 'car', transTime: 30 };
                showModal.value = true;
            };

            const editItem = (item) => {
                isEditing.value = true;
                form.value = { ...item };
                showModal.value = true;
            };

            const saveForm = () => {
                if (!form.value.title) return alert('請輸入行程名稱');
                if (isEditing.value) {
                    const idx = schedule.value.findIndex(i => i.id === form.value.id);
                    schedule.value[idx] = { ...form.value };
                } else {
                    schedule.value.push({ ...form.value });
                }
                saveToLocal();
                showModal.value = false;
            };

            const confirmDelete = () => {
                if (confirm('確定要刪除這個行程嗎？此動作無法復原。')) {
                    schedule.value = schedule.value.filter(i => i.id !== form.value.id);
                    saveToLocal();
                    showModal.value = false;
                }
            };

            const saveToLocal = () => {
                localStorage.setItem('my_hokkaido_itinerary', JSON.stringify(schedule.value));
                nextTick(() => lucide.createIcons());
            };

            const getCategoryIcon = (cat) => {
                const map = { '景點': 'map', '美食': 'utensils', '住宿': 'home', '購物': 'shopping-bag', '交通': 'car', '航班': 'plane' };
                return map[cat] || 'star';
            };

            const getCategoryStyle = (cat) => {
                const map = { '景點': 'bg-blue-50 text-blue-500', '美食': 'bg-orange-50 text-orange-400', '住宿': 'bg-green-50 text-green-500', '航班': 'bg-slate-800 text-white' };
                return map[cat] || 'bg-slate-50 text-slate-400';
            };

            onMounted(() => lucide.createIcons());
            watch([currentTab, selectedDate, showModal], () => nextTick(() => lucide.createIcons()));

            return {
                currentTab, selectedDate, dates, schedule, getCategoryIcon, getCategoryStyle,
                showModal, isEditing, form, categories, openAddModal, editItem, saveForm, confirmDelete,
                getNextItem, saveToLocal
            };
        }
    });
    app.mount('#app');
</script>

</body>
</html>
