<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—æµ·é“å†¬æ—¥æ‰‹å¸³ - 11/06-11/16</title>
    <!-- å¼•å…¥å°ˆæ¥­åº« -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/4.1.0/vuedraggable.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F7F4EB; /* ç±³è‰²æ‰‹å¸³åº•è‰² */
            background-image: radial-gradient(#E0E5D5 1px, transparent 1px);
            background-size: 24px 24px;
            color: #5C5B57;
            overflow-x: hidden;
        }

        /* Soft Shadow èˆ‡ åœ“è§’è¨­è¨ˆ */
        .journal-card {
            background: #FFFFFF;
            border-radius: 24px;
            box-shadow: 4px 4px 0px #E0E5D5;
            border: 1px solid #EAE7DC;
        }

        .banner-container {
            width: 100%;
            height: 380px;
            overflow: hidden;
            position: relative;
        }
        .banner-img {
            width: 100%; height: 100%; object-fit: cover; object-position: center 80%;
        }

        /* é é¦–åœ–ç‰‡èˆ‡å…§å®¹ç„¡ç¸«éŠœæ¥ */
        .main-content {
            margin-top: -50px;
            border-radius: 40px 40px 0 0;
            position: relative;
            z-index: 20;
            background: #F7F4EB;
            min-height: calc(100vh - 330px);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* æ‹–æ‹½å‹•ç•« */
        .ghost { opacity: 0.3; background: #CBD5E0; }
        .modal-fade-enter-active, .modal-fade-leave-active { transition: all 0.3s ease; }
        .modal-fade-enter-from, .modal-fade-leave-to { opacity: 0; transform: translateY(20px); }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen pb-32">
    
    <!-- 1. Header Banner -->
    <header class="banner-container">
        <img src="banner.jpg" class="banner-img" onerror="this.src='https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=1200'">
        
        <!-- åˆ†é  Tab æŒ‰éˆ• (æµ®åœ¨åœ–ç‰‡ä¸Šæ–¹) -->
        <div class="absolute bottom-16 right-4 flex gap-2 z-30">
            <button @click="currentTab = 'itinerary'" :class="currentTab === 'itinerary' ? 'bg-slate-700 text-white' : 'bg-white/90 text-slate-500'" class="w-10 h-10 rounded-full shadow-lg flex items-center justify-center active:scale-90 transition-all">
                <i data-lucide="map-pin" class="w-5 h-5"></i>
            </button>
            <button @click="currentTab = 'info'" :class="currentTab === 'info' ? 'bg-slate-700 text-white' : 'bg-white/90 text-slate-500'" class="w-10 h-10 rounded-full shadow-lg flex items-center justify-center active:scale-90 transition-all">
                <i data-lucide="info" class="w-5 h-5"></i>
            </button>
            <button @click="currentTab = 'shopping'" :class="currentTab === 'shopping' ? 'bg-slate-700 text-white' : 'bg-white/90 text-slate-500'" class="w-10 h-10 rounded-full shadow-lg flex items-center justify-center active:scale-90 transition-all">
                <i data-lucide="shopping-basket" class="w-5 h-5"></i>
            </button>
            <button @click="currentTab = 'expense'" :class="currentTab === 'expense' ? 'bg-slate-700 text-white' : 'bg-white/90 text-slate-500'" class="w-10 h-10 rounded-full shadow-lg flex items-center justify-center active:scale-90 transition-all">
                <i data-lucide="circle-dollar-sign" class="w-5 h-5"></i>
            </button>
        </div>
    </header>

    <!-- 2. ä¸»å…§å®¹å€åŸŸ -->
    <main class="main-content px-5 pt-8">
        
        <div v-if="currentTab === 'itinerary'">
            <!-- å¤©æ°£è³‡è¨Šå¡ç‰‡ -->
            <div class="journal-card p-4 mb-6 flex justify-between items-center bg-blue-50/50">
                <div>
                    <h2 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="cloud-snow" class="text-blue-400"></i> æœ­å¹Œ
                    </h2>
                    <p class="text-xs text-slate-400">ç•¶æ—¥æ°£æº« 2Â°C / é«”æ„Ÿ -2Â°C</p>
                </div>
                <div class="text-right">
                    <p class="text-xs font-bold text-blue-500">Snowy</p>
                    <p class="text-[10px] text-slate-400 italic">Winter Trip</p>
                </div>
            </div>

            <!-- æ©«å‘æ²å‹•æ—¥æœŸé¸æ“‡å™¨ -->
            <div class="flex overflow-x-auto no-scrollbar gap-3 mb-8 pb-2">
                <div v-for="d in dates" :key="d.date" 
                     @click="selectedDate = d.date"
                     :class="selectedDate === d.date ? 'bg-slate-700 text-white shadow-lg' : 'bg-white text-slate-400'"
                     class="flex-shrink-0 w-12 h-20 rounded-2xl flex flex-col items-center justify-center border border-slate-100 transition-all cursor-pointer">
                    <span class="text-[11px] font-bold mb-1">{{ d.weekday }}</span>
                    <span class="text-xl font-bold">{{ d.day }}</span>
                </div>
            </div>

            <!-- æ¯æ—¥è¡Œç¨‹æ™‚é–“è»¸ (æ”¯æ´æ‹–æ›³) -->
            <div class="relative">
                <draggable 
                    v-model="schedule" 
                    item-key="id"
                    handle=".drag-handle"
                    ghost-class="ghost"
                    @end="saveToLocal"
                >
                    <template #item="{element, index}">
                        <div v-if="element.date === selectedDate" class="relative pl-8 mb-4">
                            <!-- æ™‚é–“è»¸é»é» -->
                            <div class="absolute left-3 top-0 bottom-0 w-0.5 border-l-2 border-dashed border-slate-200"></div>
                            <div class="absolute left-0 top-1 w-6 h-6 bg-white border-2 border-slate-700 rounded-full flex items-center justify-center z-10 drag-handle cursor-grab active:cursor-grabbing">
                                <i :data-lucide="getCategoryIcon(element.category)" class="w-3 h-3 text-slate-700"></i>
                            </div>

                            <!-- è¡Œç¨‹å¡ç‰‡ -->
                            <div class="journal-card p-4 active:scale-[0.98] transition-all cursor-pointer" @click="editItem(element)">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{{ element.time }}</span>
                                    <span class="px-2 py-0.5 rounded-full text-[9px] font-bold" :class="getCategoryStyle(element.category)">
                                        {{ element.category }}
                                    </span>
                                </div>
                                <h3 class="font-bold text-slate-700 text-base leading-tight">{{ element.title }}</h3>
                                
                                <div class="mt-2 space-y-1">
                                    <p v-if="element.openTime" class="text-[10px] text-slate-400 flex items-center gap-1">
                                        <i data-lucide="clock" class="w-3 h-3"></i> ç‡Ÿæ¥­: {{ element.openTime }}
                                    </p>
                                    <p v-if="element.ticket" class="text-[10px] text-blue-500 flex items-center gap-1">
                                        <i data-lucide="ticket" class="w-3 h-3"></i> é–€ç¥¨: {{ element.ticket }}
                                    </p>
                                    <p v-if="element.note" class="text-xs text-slate-500 mt-2 bg-slate-50 p-2 rounded-lg italic leading-relaxed">
                                        {{ element.note }}
                                    </p>
                                </div>

                                <!-- åœ°åœ–é€£çµæŒ‰éˆ• (æ•´åˆå°èˆª) -->
                                <div class="mt-3 pt-3 border-t border-slate-50 flex justify-end">
                                    <button @click.stop="openMap(element.title)" class="text-[10px] font-bold text-blue-500 flex items-center gap-1">
                                        <i data-lucide="navigation" class="w-3 h-3"></i> å°èˆªè‡³æ­¤
                                    </button>
                                </div>
                            </div>

                            <!-- äº¤é€šæ™‚é–“é¡¯ç¤º (è¨ˆç®—åˆ°ä¸‹ä¸€å€‹è¡Œç¨‹) -->
                            <div v-if="hasFollowingItem(index)" class="my-4 flex items-center gap-2">
                                <div class="bg-[#E0E5D5] px-3 py-1 rounded-full flex items-center gap-2 text-[10px] text-slate-600 font-medium">
                                    <i :data-lucide="element.transMode || 'car'" class="w-3 h-3"></i>
                                    <span>ä¸‹ç«™ç´„ {{ element.transTime || '--' }} åˆ†é˜</span>
                                </div>
                            </div>
                        </div>
                    </template>
                </draggable>
            </div>

            <!-- æ–°å¢è¡Œç¨‹æŒ‰éˆ• (+) -->
            <button @click="openAddModal" class="fixed bottom-28 right-6 w-14 h-14 bg-slate-700 text-white rounded-full shadow-2xl flex items-center justify-center active:scale-75 transition-all z-50">
                <i data-lucide="plus" class="w-8 h-8"></i>
            </button>
        </div>

        <!-- 3. å…¶ä»–åˆ†é  (è³‡è¨Š/åŒ¯ç‡/èŠ±è²») -->
        <div v-if="currentTab === 'info'" class="space-y-6">
            <h2 class="text-xl font-bold">æ—…è¡Œè³‡è¨Š</h2>
            <!-- ç°¡å–®åŒ¯ç‡æ›ç®— -->
            <div class="journal-card p-5 bg-slate-800 text-white">
                <p class="text-[10px] opacity-60 mb-2 uppercase tracking-widest">Currency Converter</p>
                <div class="flex items-center gap-4">
                    <input type="number" v-model="jpyInput" class="w-full bg-white/10 border-none rounded-xl p-2 text-lg font-bold" placeholder="JPY">
                    <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    <div class="w-full p-2 text-lg font-bold">NT$ {{ Math.round(jpyInput * 0.21) }}</div>
                </div>
            </div>
            <div class="text-center py-10 text-slate-300 italic">æ›´å¤šèˆªç­ã€ä½å®¿ç´°ç¯€è«‹è‡³è¡Œç¨‹è¡¨æŸ¥çœ‹</div>
        </div>

    </main>

    <!-- 4. åº•éƒ¨å°èˆªæ¬„ -->
    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-md bg-white/90 backdrop-blur-md h-18 rounded-3xl border border-slate-100 shadow-2xl flex items-center justify-around px-6 z-50">
        <button @click="currentTab = 'itinerary'" :class="currentTab === 'itinerary' ? 'text-slate-800' : 'text-slate-300'" class="flex flex-col items-center gap-1 transition-all">
            <i data-lucide="calendar" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">è¡Œç¨‹</span>
        </button>
        <button @click="currentTab = 'info'" :class="currentTab === 'info' ? 'text-slate-800' : 'text-slate-300'" class="flex flex-col items-center gap-1 transition-all">
            <i data-lucide="info" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">è³‡è¨Š</span>
        </button>
        <button @click="currentTab = 'shopping'" :class="currentTab === 'shopping' ? 'text-slate-800' : 'text-slate-300'" class="flex flex-col items-center gap-1 transition-all">
            <i data-lucide="shopping-bag" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">è³¼ç‰©</span>
        </button>
        <button @click="currentTab = 'expense'" :class="currentTab === 'expense' ? 'text-slate-800' : 'text-slate-300'" class="flex flex-col items-center gap-1 transition-all">
            <i data-lucide="wallet" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">èŠ±è²»</span>
        </button>
    </nav>

    <!-- 5. ç·¨è¼¯/æ–°å¢å½ˆçª—ç³»çµ± -->
    <transition name="modal-fade">
        <div v-if="showModal" class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4">
            <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" @click="showModal = false"></div>
            <div class="relative bg-white w-full max-w-md rounded-t-[40px] sm:rounded-[40px] p-8 shadow-2xl overflow-y-auto max-h-[90vh]">
                <h2 class="text-xl font-bold mb-6 text-slate-700">{{ isEditing ? 'ä¿®æ”¹è¡Œç¨‹' : 'åŠ å…¥æ–°è¡Œç¨‹' }}</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 block mb-1">åˆ†é¡</label>
                        <select v-model="form.category" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm">
                            <option v-for="c in categories" :key="c" :value="c">{{ c }}</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 block mb-1">åœ°é»åç¨±</label>
                        <input v-model="form.title" type="text" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm" placeholder="å»å“ªè£¡ï¼Ÿ">
                    </div>
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label class="text-[10px] font-bold text-slate-400 block mb-1">æ™‚é–“</label>
                            <input v-model="form.time" type="text" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm" placeholder="09:00">
                        </div>
                        <div class="flex-1">
                            <label class="text-[10px] font-bold text-slate-400 block mb-1">äº¤é€šå·¥å…·</label>
                            <select v-model="form.transMode" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm">
                                <option value="car">ğŸš— é–‹è»Š</option>
                                <option value="bus">ğŸšŒ å¤§çœ¾é‹è¼¸</option>
                                <option value="foot">ğŸš¶ æ­¥è¡Œ</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 block mb-1">å‚™è¨»/ç‰¹è‰²</label>
                        <textarea v-model="form.note" class="w-full bg-slate-50 border-none rounded-xl p-3 text-sm h-24" placeholder="ç­†è¨˜ä¸€ä¸‹..."></textarea>
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button v-if="isEditing" @click="confirmDelete" class="flex-1 py-4 rounded-2xl bg-red-50 text-red-500 font-bold text-sm">åˆªé™¤</button>
                        <button @click="saveForm" class="flex-[2] py-4 rounded-2xl bg-slate-700 text-white font-bold text-sm">å„²å­˜</button>
                    </div>
                </div>
            </div>
        </div>
    </transition>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

    createApp({
        components: {
            draggable: window.vuedraggable
        },
        setup() {
            const currentTab = ref('itinerary');
            const selectedDate = ref('2025-11-06');
            const showModal = ref(false);
            const isEditing = ref(false);
            const jpyInput = ref(1000);
            const categories = ['æ™¯é»', 'ä½å®¿', 'ç¾é£Ÿ', 'è³¼ç‰©', 'èˆªç­', 'äº¤é€š', 'å…¶ä»–'];

            // é è¼‰è¡Œç¨‹è³‡è¨Š
            const initialSchedule = [
                // Day 1
                { id: 1, date: '2025-11-06', time: '09:10', category: 'èˆªç­', title: 'å°åŒ—(TSA) - ç¾½ç”°(HND)', note: 'JL96 (09:10-13:00)\nè½‰æ©Ÿ2å°æ™‚ï¼ŒT3æ‹‰è¡Œæï¼Œéåœ‹å…§ç·šå®‰æª¢æ­å…¬è»Š', transMode: 'bus', transTime: 120 },
                { id: 2, date: '2025-11-06', time: '15:30', category: 'èˆªç­', title: 'ç¾½ç”°(HND) - æ–°åƒæ­²(CTS)', note: 'JL521 (15:30-17:00)\nT1é£›æœ­å¹Œ', transMode: 'bus', transTime: 30 },
                { id: 3, date: '2025-11-06', time: '17:30', category: 'äº¤é€š', title: 'æ–°åƒæ­²åœ‹å…§ç·š B1 JRè»Šç«™', note: 'è²©è³£æ©Ÿè²·æŒ‡å®šå¸­è»Šç¥¨ (1680yen)', transMode: 'bus', transTime: 30 },
                { id: 4, date: '2025-11-06', time: '18:00', category: 'ä½å®¿', title: 'Mitsui Garden Hotel Sapporo West', note: 'Check-in é£¯åº—', openTime: '15:00+' },
                { id: 5, date: '2025-11-06', time: '19:30', category: 'ç¾é£Ÿ', title: 'å¥§èŠå•†åº— æ¹¯å’–å“© (ç«™å‰å‰µæˆå¯º)', note: 'æ™šé¤æ™‚é–“ï¼Œé€› 3 coins / Lakole', openTime: '11:00-22:00' },
                
                // Day 2
                { id: 6, date: '2025-11-07', time: '08:00', category: 'äº¤é€š', title: 'Toyota ç§Ÿè»Šå–è»Š (æœ­å¹Œç«™å—å£åº—)', transMode: 'car', transTime: 180 },
                { id: 7, date: '2025-11-07', time: '11:00', category: 'ç¾é£Ÿ', title: 'Furano DÃ©lÃ­ce', note: 'åƒèµ·å¸è›‹ç³•', openTime: '10:00-18:00', transMode: 'car', transTime: 60 },
                { id: 8, date: '2025-11-07', time: '12:00', category: 'ç¾é£Ÿ', title: 'Furanoya æ¹¯å’–å“©', note: 'åˆé¤æ™‚é–“', transMode: 'car', transTime: 60 },
                { id: 9, date: '2025-11-07', time: '13:00', category: 'æ™¯é»', title: 'å¯Œç”°è¾²å ´', note: 'ç¶“å…¸è–°è¡£è‰/èŠ±ç”°æ•£ç­–', transMode: 'car', transTime: 120 },
                { id: 10, date: '2025-11-07', time: '15:00', category: 'æ™¯é»', title: 'ç™½é‡‘æ¸…æ± ', transMode: 'car', transTime: 60 },
                { id: 11, date: '2025-11-07', time: '16:00', category: 'æ™¯é»', title: 'ç™½é¬šç€‘å¸ƒ', transMode: 'car', transTime: 60 },
                { id: 12, date: '2025-11-07', time: '17:00', category: 'æ™¯é»', title: 'è–èª•æ¨¹ä¹‹æœ¨', transMode: 'car', transTime: 60 },
                { id: 13, date: '2025-11-07', time: '18:00', category: 'ä½å®¿', title: 'JR Inn æ—­å·', note: 'Aeonåƒæ™šé¤', transMode: 'car', transTime: 30 },

                // Day 3
                { id: 14, date: '2025-11-08', time: '09:30', category: 'æ™¯é»', title: 'æ—­å²³çºœè»Š (å±±éº“ç«™-å§¿è¦‹ç«™)', note: 'æ—­å²³å¤§é›ªå±±æ•£ç­–', transMode: 'foot', transTime: 150 },
                { id: 15, date: '2025-11-08', time: '12:30', category: 'ç¾é£Ÿ', title: 'å§¿è¦‹é£Ÿå ‚', note: 'åˆé¤', transMode: 'car', transTime: 90 },
                { id: 16, date: '2025-11-08', time: '14:00', category: 'æ™¯é»', title: 'å°±å¯¦ä¹‹ä¸˜', transMode: 'car', transTime: 120 },
                { id: 17, date: '2025-11-08', time: '16:00', category: 'æ™¯é»', title: 'ç”·å±±é…’é€ è³‡æ–™é¤¨', note: 'æ¸…é…’æ–‡åŒ–åƒè§€', transMode: 'car', transTime: 120 },
                { id: 18, date: '2025-11-08', time: '18:00', category: 'ç¾é£Ÿ', title: 'æˆå‰æ€æ±—å¤§é»‘å±‹', note: 'çƒ¤ç¾Šè‚‰æ™šé¤' },

                // Day 4
                { id: 19, date: '2025-11-09', time: '09:00', category: 'äº¤é€š', title: 'å‡ºç™¼å‰å¾€å°æ¨½', transMode: 'car', transTime: 120 },
                { id: 20, date: '2025-11-09', time: '11:00', category: 'ç¾é£Ÿ', title: 'å°æ¨½ä¸‰è§’å¸‚å ´', note: 'åƒæµ·é®®ä¸¼', transMode: 'foot', transTime: 60 },
                { id: 21, date: '2025-11-09', time: '13:00', category: 'æ™¯é»', title: 'å°æ¨½é‹æ²³ & cafe BAAL', transMode: 'foot', transTime: 90 },
                { id: 22, date: '2025-11-09', time: '14:30', category: 'ç¾é£Ÿ', title: 'LeTAO ç¸½åº—', note: 'ä¸‹åˆèŒ¶æ™‚é–“', transMode: 'car', transTime: 60 },
                { id: 23, date: '2025-11-09', time: '15:30', category: 'æ™¯é»', title: 'ç™½è‰²æˆ€äººå…¬åœ’', transMode: 'car', transTime: 90 },
                { id: 24, date: '2025-11-09', time: '17:00', category: 'æ™¯é»', title: 'æœ­å¹Œå•¤é…’åšç‰©é¤¨', transMode: 'car', transTime: 120 },
                { id: 25, date: '2025-11-09', time: '19:00', category: 'ç¾é£Ÿ', title: 'éºµå±‹ç¿” æœ­å¹Œåº—', note: 'æ‹‰éºµæ™šé¤', transMode: 'foot', transTime: 60 },
                { id: 26, date: '2025-11-09', time: '20:00', category: 'æ™¯é»', title: 'æœ­å¹Œæ™‚è¨ˆå° / å¤§é€šå…¬åœ’', note: 'ä½å®¿: VESSEL HOTEL Campana Susukino' },

                // Day 5
                { id: 27, date: '2025-11-10', time: '08:35', category: 'æ™¯é»', title: 'åŒ—æµ·é“å»³ç´…ç£šå»³èˆ', transMode: 'car', transTime: 30 },
                { id: 28, date: '2025-11-10', time: '09:00', category: 'æ™¯é»', title: 'åŒ—æµ·é“ç¥å®®', transMode: 'car', transTime: 150 },
                { id: 29, date: '2025-11-10', time: '11:30', category: 'ç¾é£Ÿ', title: 'Amano Family Farm', note: 'åˆé¤æ™‚é–“', transMode: 'car', transTime: 90 },
                { id: 30, date: '2025-11-10', time: '13:00', category: 'æ™¯é»', title: 'ç™»åˆ¥åœ°ç„è°·', transMode: 'foot', transTime: 60 },
                { id: 31, date: '2025-11-10', time: '14:00', category: 'æ™¯é»', title: 'ç™»åˆ¥æ£•ç†Šç‰§å ´', transMode: 'car', transTime: 180 },
                { id: 32, date: '2025-11-10', time: '17:30', category: 'ä½å®¿', title: 'æ´çˆºæ¹–-ä¹ƒä¹‹é¢¨', note: 'äº«å—æº«æ³‰èˆ‡æ¹–æ™¯' }
            ];

            const schedule = ref(JSON.parse(localStorage.getItem('hokkaido_v3')) || initialSchedule);
            const form = ref({});

            const dates = [
                { weekday: 'Thu', day: '06', date: '2025-11-06' }, { weekday: 'Fri', day: '07', date: '2025-11-07' },
                { weekday: 'Sat', day: '08', date: '2025-11-08' }, { weekday: 'Sun', day: '09', date: '2025-11-09' },
                { weekday: 'Mon', day: '10', date: '2025-11-10' }, { weekday: 'Tue', day: '11', date: '2025-11-11' },
                { weekday: 'Wed', day: '12', date: '2025-11-12' }, { weekday: 'Thu', day: '13', date: '2025-11-13' },
                { weekday: 'Fri', day: '14', date: '2025-11-14' }, { weekday: 'Sat', day: '15', date: '2025-11-15' },
                { weekday: 'Sun', day: '16', date: '2025-11-16' }
            ];

            const openAddModal = () => {
                isEditing.value = false;
                form.value = { id: Date.now(), date: selectedDate.value, category: 'æ™¯é»', time: '10:00', title: '', transMode: 'car' };
                showModal.value = true;
            };

            const editItem = (item) => {
                isEditing.value = true;
                form.value = { ...item };
                showModal.value = true;
            };

            const saveForm = () => {
                if (!form.value.title) return alert('è«‹è¼¸å…¥åç¨±');
                if (isEditing.value) {
                    const idx = schedule.value.findIndex(i => i.id === form.value.id);
                    schedule.value[idx] = { ...form.value };
                } else {
                    schedule.value.push({ ...form.value });
                }
                saveToLocal();
                showModal.value = false;
            };

            const confirmDelete = () => {
                if (confirm('ç¢ºå®šåˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) {
                    schedule.value = schedule.value.filter(i => i.id !== form.value.id);
                    saveToLocal();
                    showModal.value = false;
                }
            };

            const saveToLocal = () => {
                localStorage.setItem('hokkaido_v3', JSON.stringify(schedule.value));
                nextTick(() => lucide.createIcons());
            };

            const openMap = (title) => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(title)}`, '_blank');
            };

            const hasFollowingItem = (index) => {
                const current = schedule.value[index];
                return schedule.value.slice(index + 1).some(i => i.date === current.date);
            };

            const getCategoryIcon = (cat) => {
                const map = { 'æ™¯é»': 'map', 'ç¾é£Ÿ': 'utensils', 'ä½å®¿': 'home', 'èˆªç­': 'plane', 'äº¤é€š': 'car', 'è³¼ç‰©': 'shopping-bag' };
                return map[cat] || 'star';
            };

            const getCategoryStyle = (cat) => {
                const map = { 'æ™¯é»': 'bg-blue-50 text-blue-500', 'ç¾é£Ÿ': 'bg-orange-50 text-orange-400', 'ä½å®¿': 'bg-green-50 text-green-500', 'èˆªç­': 'bg-slate-800 text-white' };
                return map[cat] || 'bg-slate-50 text-slate-400';
            };

            onMounted(() => lucide.createIcons());
            watch([currentTab, selectedDate, showModal], () => nextTick(() => lucide.createIcons()));

            return {
                currentTab, selectedDate, dates, schedule, showModal, isEditing, form, categories,
                jpyInput, openAddModal, editItem, saveForm, confirmDelete, openMap, hasFollowingItem,
                getCategoryIcon, getCategoryStyle, saveToLocal
            };
        }
    }).mount('#app');
</script>

</body>
</html>
